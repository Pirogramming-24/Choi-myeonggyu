{% extends 'base.html' %} 

{% block title %}Idea List{% endblock %}

{% block extra_css %}
<style>
    /* ë©”ì¸ íƒ€ì´í‹€ ì˜ì—­ */
    .main-header { text-align: center; margin-bottom: 40px; }
    .main-header h1 { color: #A6E22E; font-size: 2.5rem; margin-bottom: 10px; }
    .main-header p { color: #888; }

    /* ì •ë ¬ ë“œë¡­ë‹¤ìš´ ìŠ¤íƒ€ì¼ */
    #sort-select {
        margin-top: 10px; padding: 8px 15px; border-radius: 20px;
        background-color: #333; color: white; border: 1px solid #555;
        cursor: pointer; outline: none;
    }

    /* ì¹´ë“œ ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
    .card-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 30px;
        min-height: 400px; /* ì•„ì´ë””ì–´ê°€ ì ì–´ë„ ë ˆì´ì•„ì›ƒ ìœ ì§€ */
    }

    /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
    .card {
        background-color: #2D2D2D; border-radius: 15px; overflow: hidden;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3); transition: transform 0.3s;
        position: relative; display: flex; flex-direction: column;
    }
    .card:hover { transform: translateY(-10px); }

    /* ì°œí•˜ê¸° ì•„ì´ì½˜ */
    .star-btn {
        position: absolute; top: 15px; right: 15px; font-size: 1.5rem;
        color: #555; cursor: pointer; z-index: 10;
        text-shadow: 0 0 5px rgba(0,0,0,0.5); /* ì˜ ë³´ì´ê²Œ ê·¸ë¦¼ì ì¶”ê°€ */
    }
    .star-btn.starred { color: #FFD700; }

    /* ì¹´ë“œ ì´ë¯¸ì§€ */
    .card-img-top {
        width: 100%; height: 180px; object-fit: cover; background-color: #444;
    }
    .no-img { 
        width: 100%; height: 180px; display: flex; justify-content: center; 
        align-items: center; color: #888; background-color: #333; font-weight: bold;
    }

    /* ì¹´ë“œ ë‚´ìš© */
    .card-body { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }
    .card-title { font-size: 1.2rem; margin-bottom: 10px; display: block; font-weight: bold; color: #fff;}
    .card-info { font-size: 0.9rem; color: #bbb; margin-bottom: 15px;}

    /* ê´€ì‹¬ë„ ì¡°ì • ì˜ì—­ */
    .interest-control { display: flex; align-items: center; font-size: 1rem; color: #ddd; }
    .btn-interest { background: none; border: none; color: #aaa; font-size: 1.3rem; padding: 0 8px; transition: color 0.2s; }
    .btn-interest:hover { color: #fff; transform: scale(1.2); }
    .interest-score { margin: 0 5px; font-weight: bold; color: #A6E22E; min-width: 20px; text-align: center;}

    /* í˜ì´ì§€ë„¤ì´ì…˜ ìŠ¤íƒ€ì¼ */
    .pagination { text-align: center; margin-top: 50px; color: #aaa; }
    .pagination a { color: #A6E22E; margin: 0 10px; text-decoration: none; font-weight: bold; padding: 5px 10px; border: 1px solid #333; border-radius: 5px; }
    .pagination a:hover { background-color: #333; }
    .current { font-weight: bold; color: #fff; }
</style>
{% endblock %}

{% block content %}
    <div class="main-header">
        <h1>Idea List</h1>
        <p>ë‚˜ì˜ ì•„ì´ë””ì–´ë¥¼ ë©‹ì§€ê²Œ ê´€ë¦¬í•´ë³´ì„¸ìš”</p>

        <select id="sort-select" onchange="location = this.value;">
            <option value="?sort=recent" {% if sort == 'recent' %}selected{% endif %}>ìµœì‹ ìˆœ</option>
            <option value="?sort=oldest" {% if sort == 'oldest' %}selected{% endif %}>ë“±ë¡ìˆœ</option>
            <option value="?sort=likes" {% if sort == 'likes' %}selected{% endif %}>ì°œí•˜ê¸°ìˆœ</option>
            <option value="?sort=interest" {% if sort == 'interest' %}selected{% endif %}>ê´€ì‹¬ë„ìˆœ</option>
            <option value="?sort=name" {% if sort == 'name' %}selected{% endif %}>ì´ë¦„ìˆœ</option>
        </select>
    </div>

    <div class="card-container">
        {% for idea in ideas %}
        <div class="card">
        
            {% if user.is_authenticated %}
                <i class="fa-solid fa-star star-btn {% if idea.pk in starred_idea_ids %}starred{% endif %}" 
                   onclick="toggleStar(this, {{ idea.pk }})"></i>
            {% endif %}
            
            {% if idea.image %}
                <img src="{{ idea.image.url }}" class="card-img-top" alt="{{ idea.title }}">
            {% else %}
                <div class="no-img">No Image</div>
            {% endif %}

            <div class="card-body">
                <div>
                    <a href="{% url 'ideas:idea_detail' idea.pk %}" class="card-title">{{ idea.title }}</a>
                    <p class="card-info">ğŸ› ï¸ {{ idea.devtool.name }}</p>
                </div>
                
                <div class="interest-control">
                    ê´€ì‹¬ë„ 
                    <button class="btn-interest" onclick="updateInterest(this, {{ idea.pk }}, 'down')">ï¼</button>
                    <span id="interest-{{ idea.pk }}" class="interest-score">{{ idea.interest }}</span>
                    <button class="btn-interest" onclick="updateInterest(this, {{ idea.pk }}, 'up')">ï¼‹</button>
                </div>
            </div>
        </div> {% empty %}
        <p style="text-align: center; grid-column: 1/-1;">ë“±ë¡ëœ ì•„ì´ë””ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endfor %}
    </div>

    <div class="pagination">
        {% if ideas.has_previous %}
            <a href="?page={{ ideas.previous_page_number }}&sort={{ sort }}">&laquo; ì´ì „</a>
        {% endif %}

        <span class="current">
            Page {{ ideas.number }} of {{ ideas.paginator.num_pages }}
        </span>

        {% if ideas.has_next %}
            <a href="?page={{ ideas.next_page_number }}&sort={{ sort }}">ë‹¤ìŒ &raquo;</a>
        {% endif %}
    </div>
{% endblock %}

{% block extra_js %}
<script>
    // 1. ê´€ì‹¬ë„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateInterest(btn, pk, action) {
        const url = `/${pk}/interest/${action}/`; 
        fetch(url, {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrftoken,
                'Content-Type': 'application/json',
            },
        })
        .then(response => response.json())
        .then(data => {
            document.querySelector(`#interest-${pk}`).textContent = data.interest;
        })
        .catch(error => console.error('Error:', error));
    }

    // 2. ì°œí•˜ê¸° í† ê¸€ í•¨ìˆ˜
    function toggleStar(icon, pk) {
        const url = `/${pk}/star/`;
        fetch(url, {
            method: 'POST',
            headers: {'X-CSRFToken': csrftoken},
        })
        .then(response => response.json())
        .then(data => {
            if (data.is_starred) {
                icon.classList.add('starred'); 
            } else {
                icon.classList.remove('starred');
            }
        })
        .catch(error => console.error('Error:', error));
    }
</script>
{% endblock %}