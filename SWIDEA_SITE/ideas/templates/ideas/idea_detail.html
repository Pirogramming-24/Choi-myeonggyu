{% extends 'base.html' %}

{% block title %}{{ idea.title }} - ìƒì„¸ì •ë³´{% endblock %}

{% block extra_css %}
<style>
    /* ìƒì„¸ í˜ì´ì§€ ì»¨í…Œì´ë„ˆ (ì‚¬ì´ì¦ˆ ì¶•ì†Œ) */
    .detail-container {
        max-width: 600px; /* ë„ˆë¹„ë¥¼ 600pxë¡œ ì¤„ì„ */
        margin: 0 auto;
        background-color: #2D2D2D;
        padding: 30px; /* íŒ¨ë”© ì¶•ì†Œ */
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        position: relative;
        color: white;
    }

    /* ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ (ë†’ì´ ì œí•œ ê°•í™”) */
    .detail-img {
        width: 100%;
        max-height: 250px; /* ë†’ì´ë¥¼ 250pxë¡œ ì œí•œ (í•œ ëˆˆì— ë“¤ì–´ì˜¤ê²Œ) */
        object-fit: contain; /* ë¹„ìœ¨ ìœ ì§€í•˜ë©° ì•ˆì— ë§ì¶¤ */
        background-color: #222; /* ë¹ˆ ê³µê°„ ë°°ê²½ìƒ‰ ë” ì–´ë‘¡ê²Œ */
        border-radius: 8px;
        margin-bottom: 20px;
        border: 1px solid #444;
    }
    .no-img-box {
        width: 100%; height: 150px; /* ë†’ì´ ì¶•ì†Œ */
        background-color: #333;
        display: flex; justify-content: center; align-items: center;
        color: #888; border-radius: 8px; margin-bottom: 20px;
        font-weight: bold; font-size: 0.9rem;
    }

    /* [ì¶”ê°€] ê°œë°œíˆ´ ë§í¬ ìŠ¤íƒ€ì¼ */
    .devtool-link {
        color: #A6E22E; /* í¬ì¸íŠ¸ ìƒ‰ìƒ (ì—°ë‘ìƒ‰) */
        text-decoration: none;
        font-weight: bold;
        transition: color 0.2s;
    }
    .devtool-link:hover {
        color: #fff; /* ë§ˆìš°ìŠ¤ ì˜¬ë¦¬ë©´ í°ìƒ‰ */
        text-decoration: underline;
    }

    /* í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
    h2 { margin-bottom: 5px; font-size: 1.8rem; color: #fff; text-align: center; } /* ì œëª© ê°€ìš´ë° ì •ë ¬, í¬ê¸° ì¶•ì†Œ */
    
    .meta-info { 
        color: #aaa; margin-bottom: 15px; font-size: 0.9rem; 
        border-bottom: 1px solid #444; padding-bottom: 15px; text-align: center; 
    }
    .meta-info span { margin: 0 10px; }
    
    .content-box { 
        background-color: #333; padding: 15px; 
        border-radius: 8px; color: #ddd; line-height: 1.6; margin-bottom: 20px;
        font-size: 1rem; white-space: pre-wrap;
        min-height: 100px; /* ìµœì†Œ ë†’ì´ ì„¤ì • */
    }

    /* ì°œí•˜ê¸° ë³„ */
    .star-btn-detail {
        position: absolute; top: 30px; right: 30px;
        font-size: 2rem; color: #555; cursor: pointer;
        transition: transform 0.2s;
    }
    .star-btn-detail:hover { transform: scale(1.1); }
    .star-btn-detail.starred { color: #FFD700; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }

    /* ê´€ì‹¬ë„ ì»¨íŠ¸ë¡¤ (ë” ì‘ê²Œ) */
    .interest-area {
        display: flex; align-items: center; justify-content: center;
        background-color: #1E1E1E; padding: 10px 20px; border-radius: 40px;
        width: fit-content; margin: 0 auto 20px auto; border: 1px solid #444;
    }
    .btn-interest { background: none; border: none; color: #aaa; font-size: 1.5rem; cursor: pointer; padding: 0 15px; transition: color 0.2s;}
    .btn-interest:hover { color: white; transform: scale(1.2); }
    .interest-label { font-size: 1rem; margin-right: 10px; color: #bbb; }
    .interest-score { font-size: 1.5rem; font-weight: bold; color: #A6E22E; min-width: 30px; text-align: center; }

    /* í•˜ë‹¨ ë²„íŠ¼ ê·¸ë£¹ */
    .btn-group { display: flex; gap: 10px; justify-content: center; }
    .btn-action {
        padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold;
        text-decoration: none; color: white; font-size: 0.9rem; transition: opacity 0.2s;
    }
    .btn-action:hover { opacity: 0.9; }
    
    .btn-list { background-color: #555; }
    .btn-edit { background-color: #2196F3; }
    .btn-delete { background-color: #ff4757; }
</style>
{% endblock %}

{% block content %}
<div class="detail-container">
    
    {% if user.is_authenticated %}
        <i class="fa-solid fa-star star-btn-detail {% if is_starred %}starred{% endif %}" 
           onclick="toggleStar(this, {{ idea.pk }})"></i>
    {% endif %}
    
    <h2>{{ idea.title }}</h2>
    <div class="meta-info">
            <span>ğŸ› ï¸ 
                {% for tool in idea.devtools.all %}
                    <a href="{% url 'ideas:devtool_detail' tool.pk %}?prev=idea_detail&idea_pk={{ idea.pk }}" class="devtool-link">
                        {{ tool.name }}
                    </a>
                    {% if not forloop.last %}, {% endif %}
                {% empty %}
                    ì„ íƒ ì•ˆ í•¨
                {% endfor %}
            </span>
            
            <span>ğŸ“… {{ idea.created_at|date:"Y.m.d" }}</span>
        </div>

    {% if idea.image %}
        <a href="{{ idea.image.url }}" target="_blank" title="í´ë¦­í•´ì„œ ì›ë³¸ ë³´ê¸°">
            <img src="{{ idea.image.url }}" class="detail-img" alt="{{ idea.title }}">
        </a>
    {% else %}
        <div class="no-img-box">No Image</div>
    {% endif %}

    <div class="interest-area">
        <span class="interest-label">ê´€ì‹¬ë„</span>
        <button class="btn-interest" onclick="updateInterest({{ idea.pk }}, 'down')">ï¼</button>
        <span id="interest-{{ idea.pk }}" class="interest-score">{{ idea.interest }}</span>
        <button class="btn-interest" onclick="updateInterest({{ idea.pk }}, 'up')">ï¼‹</button>
    </div>

    <div class="content-box">{{ idea.content }}</div>

    <div class="btn-group">
        
        {% if prev == 'devtool_detail' and devtool_pk %}
            <a href="{% url 'ideas:devtool_detail' devtool_pk %}" class="btn-action btn-list">â¬…ï¸ ê°œë°œíˆ´ì •ë³´ë¡œ</a>
        {% else %}
            <a href="{% url 'ideas:idea_list' %}" class="btn-action btn-list">ëª©ë¡</a>
        {% endif %}

        <a href="{% url 'ideas:idea_update' idea.pk %}" class="btn-action btn-edit">ìˆ˜ì •</a>
        
        <form action="{% url 'ideas:idea_delete' idea.pk %}" method="POST" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="btn-action btn-delete" onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');">ì‚­ì œ</button>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function updateInterest(pk, action) {
        const url = `/${pk}/interest/${action}/`;
        fetch(url, {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrftoken,
                'Content-Type': 'application/json',
            },
        })
        .then(res => res.json())
        .then(data => {
            document.querySelector(`#interest-${pk}`).textContent = data.interest;
        })
        .catch(err => console.error(err));
    }

    function toggleStar(icon, pk) {
        const url = `/${pk}/star/`;
        fetch(url, {
            method: 'POST',
            headers: {'X-CSRFToken': csrftoken},
        })
        .then(res => res.json())
        .then(data => {
            if (data.is_starred) {
                icon.classList.add('starred');
            } else {
                icon.classList.remove('starred');
            }
        })
        .catch(err => console.error(err));
    }
</script>
{% endblock %}